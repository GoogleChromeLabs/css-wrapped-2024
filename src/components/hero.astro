---
import { Icon } from "astro-icon/components";
import NavBento from "./nav.bento.astro";

const { biomes } = Astro.props;
---

<section>
  <div class="hero">
    <h1 class="retro-title">CSS Wrapped</h1>
    <div class="grid-pile">
      <div class="particles" id="particles">
        <span class="pixel"></span>
        <span class="pixel"></span>
        <span class="pixel"></span>
        <span class="pixel"></span>
        <span class="pixel"></span>
        <span class="pixel"></span>
        <span class="pixel"></span>
        <span class="pixel"></span>
        <span class="pixel"></span>
        <span class="pixel"></span>
        <span class="pixel"></span>
        <span class="pixel"></span>
        <span class="plus"></span>
        <span class="plus"></span>
        <span class="plus"></span>
        <span class="plus"></span>
        <span class="plus"></span>
        <span class="plus"></span>
        <span class="plus"></span>
        <span class="plus"></span>
        <span class="plus"></span>
      </div>
      <div class="video">
        <Icon name="play" />
      </div>
    </div>
    <div class="narrative">
      <Icon name="dino" size="5rem" />
      <p class="sub-title">
        <span><b>2024 CSS</b></span> journeyed<br />through the <b>forest</b>,
        over the <b>mountains</b>, and across the <b>seas</b>â€¦
      </p>
      <p class="hero-title retro-title">Pushing The Web Forward</p>
      <NavBento biomes={biomes} />
    </div>
  </div>
</section>

<script>
  const particles = document.getElementById("particles");
  const particlesArray = Array.from(particles.children);

  const random = (min, max) => Math.floor(Math.random() * (max - min) + min);
  const randomNeg = (value) => (Math.random() > 0.5 ? value : -value);

  particlesArray.forEach((particle: HTMLElement) => {
    const { matches: motionOK } = window.matchMedia(
      "(prefers-reduced-motion: no-preference)",
    );

    let randomX = randomNeg(random(70, 50));
    let randomY = randomNeg(random(85, 0));
    let randomDuration = random(1500, 6000);
    let randomRange = random(10, 200);

    particle.style.translate = `clamp(-45vi, ${randomX}cqi, 45vi) ${randomY}cqb`;
    particle.style.rotate = "1turn";
    particle.style.setProperty("--range", `${randomRange}vh`);

    if (motionOK) {
      particle.style.animationDuration = `auto, ${randomDuration}ms`;
      particle.style.animationTimingFunction =
        "var(--ease-3), var(--ease-spring-2)";
    }
  });
</script>

<style>
  @property --range {
    syntax: "<length>";
    inherits: false;
    initial-value: 0;
  }

  @keyframes particle-enter {
    from {
      translate: 0cqi 0cqi;
      rotate: 0turn;
    }
  }

  @keyframes particle-scroll {
    to {
      translate: 0cqi 0cqi;
      rotate: 0turn;
    }
  }

  @layer components.hero {
    section {
      max-inline-size: 100%;
      overflow-x: clip;
      position: relative;
      z-index: 0;
    }

    .hero {
      margin-block: var(--size-10) 20vh;
      max-inline-size: 90vw;
      margin-inline: auto;
      padding-inline: var(--size-3);
      display: grid;
      gap: 10vw;

      @media (width >= 720px) {
        max-inline-size: min(1024px, 75vw);
        padding-inline: var(--size-5);
        gap: 15vw;
      }

      > h1 {
        font-size: clamp(5rem, 11vw, 14rem);
        text-align: center;
        max-inline-size: 100%;
      }

      p {
        text-align: center;
        max-inline-size: max-content;
        margin-inline: auto;
      }

      .hero-title {
        font-size: clamp(5rem, 8vw, 9rem);
        margin-block-end: var(--size-9);
      }

      .sub-title {
        font-size: var(--font-size-4);
        font-weight: 200;
        line-height: 2.25;

        > span {
          border: 2px solid var(--surface-4);
          border-radius: var(--radius-2);
          padding-block: var(--size-1);
          padding-inline: var(--size-2);
        }
      }

      .narrative {
        display: grid;

        svg {
          @media (prefers-reduced-motion: no-preference) {
            @supports (animation-timeline: view()) {
              animation: journeyed linear both;
              animation-timeline: view(y);
              animation-range: 25% 75%;
            }
          }
        }
      }
    }

    .video {
      z-index: 1;
      aspect-ratio: 16/9;
      background: var(--surface-3);
      border-radius: var(--radius-3);

      display: grid;
      place-content: center;
      will-change: transform;

      @media (prefers-reduced-motion: no-preference) {
        animation: scale-down 3s var(--ease-2) reverse;
      }

      > svg {
        block-size: 5rem;
        inline-size: 5rem;
      }
    }

    .particles {
      position: relative;
      display: grid;
      place-items: center;
      container-type: size;

      > span {
        position: absolute;
        transform-origin: center;

        @media (prefers-reduced-motion: no-preference) {
          animation:
            particle-scroll linear both,
            particle-enter 1s ease;
          animation-timeline: scroll(y root), auto;
          animation-range: 0vh var(--range);
        }

        &.pixel {
          width: 1rem;
          height: 1rem;
          background: var(--blue-5);

          &:nth-of-type(2n) {
            background: var(--blue-2);
          }
        }

        &.plus {
          --_color: var(--blue-5);

          width: 3rem;
          height: 3rem;
          background: linear-gradient(
              to right,
              #0000 0 1rem,
              var(--_color) 1rem 2rem,
              #0000 2rem 3rem
            ),
            linear-gradient(
              to bottom,
              #0000 0 1rem,
              var(--_color) 1rem 2rem,
              #0000 2rem 3rem
            );

          &:nth-of-type(2n) {
            --_color: var(--blue-3);
          }
        }
      }
    }
  }
</style>

<style is:global>
  @keyframes journeyed {
    from {
      transform: translateX(-25vw) scaleX(calc(var(--scroll-direction, 1)));
    }
    to {
      transform: translateX(90vw) scaleX(calc(var(--scroll-direction, 1)));
    }
  }
</style>
